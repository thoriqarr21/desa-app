Lorem ipsum dolor sit, amet consectetur adipisicing elit. Aperiam iste incidunt assumenda sapiente, consectetur vitae, non ratione saepe aut odit reprehenderit sit amet, dolores laborum aliquid natus ducimus! Quidem reprehenderit illum dolorum, veritatis repudiandae assumenda?



public function index(Request $request): View
{
    $search = $request->input('search');
    $bulan = $request->input('bulan');
    $collection = LaporanKegiatan::with('kegiatan')
    ->when($search, function ($query, $search) {
        return $query->where(function ($q) use ($search) {
            $q->where('nama_kegiatan', 'like', "%{$search}%")
              ->orWhere('deskripsi_kegiatan', 'like', "%{$search}%");
        });
    })
    ->when($bulan, function ($query) use ($bulan) {
        return $query->whereHas('kegiatan', function ($q) use ($bulan) {
            $q->whereMonth('tanggal_mulai', $bulan);
        });
    })
    ->get()
    ->sortByDesc(function ($item) {
        return optional($item->kegiatan)->tanggal_mulai;
    })
    ->values();

    // Manual pagination
    $page = $request->get('page', 1);
    $perPage = 10;
    $laporan = new LengthAwarePaginator(
        $collection->forPage($page, $perPage),
        $collection->count(),
        $perPage,
        $page,
        ['path' => $request->url(), 'query' => $request->query()]
    );


    $tahunList = DesaKegiatan::selectRaw('YEAR(tanggal_mulai) as tahun')
    ->groupBy(DB::raw('YEAR(tanggal_mulai)'))
    ->orderBy('tahun', 'desc')
    ->pluck('tahun');

    // Mengirimkan data ke view
    return view('laporan_kegiatan.index', compact('laporan', 'tahunList', 'bulan'));
}


<IfModule mod_rewrite.c>
    <IfModule mod_negotiation.c>
        Options -MultiViews -Indexes
    </IfModule>

    RewriteEngine On

    # Handle Authorization Header
    RewriteCond %{HTTP:Authorization} .
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

    # Handle X-XSRF-Token Header
    RewriteCond %{HTTP:x-xsrf-token} .
    RewriteRule .* - [E=HTTP_X_XSRF_TOKEN:%{HTTP:X-XSRF-Token}]

    # Redirect Trailing Slashes If Not A Folder...
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} (.+)/$
    RewriteRule ^ %1 [L,R=301]

    # Send Requests To Front Controller...
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^ index.php [L]
    ExpiresActive On
    ExpiresByType text/css "access plus 1 week"
    ExpiresByType application/javascript "access plus 1 week"
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript application/json
</IfModule>

import { defineConfig } from 'vite';
import laravel from 'laravel-vite-plugin';
import tailwindcss from '@tailwindcss/vite';
import compression from 'vite-plugin-compression';

export default defineConfig({
    plugins: [
        laravel({
            input: [
                'resources/sass/app.scss',
                'resources/js/app.js',
            ],
            refresh: true,
        }),
        tailwindcss(),
        compression({
            algorithm: 'brotliCompress', // or 'gzip'
            ext: '.br',
            threshold: 1024, // Only compress files above 1KB
            deleteOriginFile: false, // Keep original files
        }),
    ],
    build: {
        minify: 'esbuild', // Fast & modern JS minifier
    },
});




<h5 class="mt-3 mb-2">üìå Upload Tambahan</h5>
<div class="row">
    @forelse ($grupUploadTambahan as $persen => $doks)
        @if ($doks->count())
            <div class="col-12">
                <div class="card mb-4 shadow-sm border">
                    <div class="card-header bg-light px-4 py-3">
                        <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3">

                            <!-- Kiri: Progress dan Keterangan -->
                            <div class="flex-grow-1">
                                <p class="mb-1 text-muted fw-bold">
                                    <i class="fas fa-chart-line me-1"></i> Progress :
                                    <span class="badge bg-primary bg-opacity-75" style="font-size: 15px;">{{ $persen }}%</span>
                                </p>
                                <p class="mb-0 text-muted">
                                    <i class="fas fa-comment-dots me-1"></i>
                                    <strong>Keterangan :</strong> {{ $doks->first()->keterangan ?? '-' }}
                                </p>
                            </div>

                            <!-- Kanan: Tombol Edit & Hapus -->
                            <div class="d-flex flex-wrap gap-2 justify-content-md-end">
                                <button class="btn btn-outline-primary rounded-2 px-3 shadow-sm"
                                        data-bs-toggle="modal" data-bs-target="#modalEditPersen{{ $persen }}">
                                    <i class="fas fa-pen-to-square me-1"></i> Edit
                                </button>

                                <button type="button"
                                        class="btn btn-outline-danger rounded-2 px-3 shadow-sm"
                                        data-bs-toggle="modal"
                                        data-bs-target="#modalHapusPersen{{ $persen }}">
                                    <i class="fas fa-trash-alt me-1"></i> Hapus
                                </button>
                            </div>
                        </div>
                        <!-- Modal Konfirmasi Hapus -->
                        <div class="modal fade" id="modalHapusPersen{{ $persen }}" tabindex="-1" aria-labelledby="modalHapusLabel{{ $persen }}" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content border-0 shadow">
                                    <div class="modal-header bg-danger text-white">
                                        <h5 class="modal-title" id="modalHapusLabel{{ $persen }}">
                                            <i class="fas fa-trash-alt me-1"></i> Konfirmasi Hapus
                                        </h5>
                                        <button type="button" class="btn-close btn-close-white"
                                                data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                
                                    <div class="modal-body">
                                        <p>Apakah kamu yakin ingin <strong>menghapus seluruh dokumentasi pada progres {{ $persen }}%</strong>?</p>
                                        <p class="text-muted mb-0">Tindakan ini tidak dapat dibatalkan.</p>
                                    </div>
                                
                                    <div class="modal-footer">
                                        <form method="POST" action="{{ route('dokumentasi.destroy_by_progress') }}">
                                            @csrf
                                            @method('DELETE')
                                            <input type="hidden" name="laporan_id" value="{{ $laporanProyek->id }}">
                                            <input type="hidden" name="persentase" value="{{ $persen }}">
                                
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                                            <button type="submit" class="btn btn-danger">
                                                <i class="fas fa-trash-alt me-1"></i> Hapus
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Modal Update -->
                        <div class="modal fade" id="modalEditPersen{{ $persen }}" tabindex="-1" aria-labelledby="editPersenLabel{{ $persen }}" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content border-0 shadow">
                                    <div class="modal-header bg-primary text-white">
                                        <h5 class="modal-title text-white" id="editPersenLabel{{ $persen }}">‚úèÔ∏è Edit Dokumentasi {{ $persen }}%</h5>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                        
                                    <form action="{{ route('dokumentasi.update_by_progress') }}" method="POST" enctype="multipart/form-data">
                                        @csrf
                                        <input type="hidden" name="laporan_id" value="{{ $laporanProyek->id }}">
                                        <input type="hidden" name="persentase" value="{{ $persen }}">
                        
                                        <div class="modal-body">
                                            <div class="row g-3">
                                                <!-- Upload File Baru -->
                                                <div class="col-md-12">
                                                    <label class="form-label">Ganti File (opsional)</label>
                                                    <input type="file" name="dokumentasi[]" class="form-control" accept="image/*,video/*" multiple>
                                                </div>
                        
                                                <!-- Keterangan -->
                                                <div class="col-12">
                                                    <label for="keterangan" class="form-label">Keterangan</label>
                                                    <textarea name="keterangan" class="form-control  text-long" rows="3" required>{{ $doks->first()->keterangan }}</textarea>
                                                </div>
                                            </div>
                                        </div>
                        
                                        <div class="modal-footer">
                                            <button type="submit" class="btn btn-primary"><i class="fa fa-save me-1"></i> Update Perubahan</button>
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    

                    <div class="card-body">
                        <div class="row">
                            @foreach ($doks as $dok)
                                <div class="col-md-6 col-lg-6 mb-4 position-relative">
                                    <div class="border rounded-4 overflow-hidden position-relative" style="background-color: #f8f9fa; height: 250px; max-width: 100%;">

                                        <!-- Tombol Dropdown di pojok kanan atas gambar -->
                                        <div class="position-absolute top-0 end-0 m-2 z-3">
                                            <div class="dropdown">
                                                <button class="btn btn-sm bg-light bg-opacity-75 rounded-circle shadow-sm" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                    <i class="fas fa-ellipsis-v fs-6"></i>
                                                </button>
                                                <ul class="dropdown-menu dropdown-menu-end">
                                                    <li>
                                                        <form method="POST" action="{{ route('dokumentasi.destroy', $dok->id) }}">
                                                            @csrf
                                                            @method('DELETE')
                                                            <button class="dropdown-item text-danger fw-bold" type="submit">
                                                                <i class="fas fa-trash me-2"></i>Hapus
                                                            </button>
                                                        </form>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>

                                        <!-- Gambar atau video -->
                                        @if ($dok->file_type == 'image')
                                            <img src="{{ asset('storage/' . $dok->file_path) }}"
                                                 class="w-100 h-100 object-fit-cover"
                                                 alt="Dokumentasi">
                                        @else
                                            <video controls class="w-100 h-100 object-fit-cover">
                                                <source src="{{ asset('storage/' . $dok->file_path) }}" type="{{ \File::mimeType(public_path('storage/' . $dok->file_path)) }}">
                                                Browser Anda tidak mendukung video.
                                            </video>
                                        @endif
                                    </div>
                                </div>
                            @endforeach
                        </div>
                    </div>
                </div>
            </div>              
        @endif
    @empty
        <div class="col-12">
            <p class="text-muted">Tidak ada dokumentasi tambahan tersedia.</p>
        </div>
    @endforelse
</div>

<!-- Tombol Trigger Tambah Dokumentasi Tambahan -->
@php
    $statusProyek = optional($laporanProyek->proyek)->status;
@endphp

@if($statusProyek === 'batal' || $statusProyek === 'selesai')
    <button type="button" class="btn btn-secondary w-auto w-sm-100 d-block mx-auto fs-6" disabled>
        <i class="fa fa-ban me-1"></i> Proyek {{ ucfirst($statusProyek) }}
    </button>
@else
    <button type="button" class="btn btn-primary w-auto w-sm-100 d-block mx-auto"
            data-bs-toggle="modal" data-bs-target="#modalUploadDokumentasi">
        <i class="fa fa-upload me-1"></i> Tambah Dokumentasi Tambahan
    </button>
@endif
<!-- Modal Tambahan -->
<div class="modal fade" id="modalUploadDokumentasi" tabindex="-1" aria-labelledby="uploadDokumentasiLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="uploadDokumentasiLabel">üì∏ Upload Dokumentasi Tambahan</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <form action="{{ route('laporan_proyek.storeTambahan') }}" method="POST" enctype="multipart/form-data">
                @csrf
                <input type="hidden" name="laporan_id" value="{{ $laporanProyek->id }}">

                <div class="modal-body">
                    <div class="row g-3">

                        <!-- Persentase -->
                        <div class="col-md-4">
                            <label for="persentase" class="form-label">Pilih Persentase</label>
                            <select name="persentase" class="form-control" required>
                                @forelse ($persenTersisa as $persen)
                                    <option value="{{ $persen }}">{{ $persen }}%</option>
                                @empty
                                    <option disabled>Proyek Selesai</option>
                                @endforelse
                            </select>
                        </div>

                        <!-- Upload File -->
                        <div class="col-md-8">
                            <label class="form-label">Upload Dokumentasi <small>(max 3 file: gambar/video)</small></label>
                            <input type="file" name="dokumentasi[]" class="form-control" accept="image/*,video/*" multiple required>
                        </div>

                        <!-- Keterangan -->
                        <div class="col-12">
                            <label for="keterangan" class="form-label">Keterangan</label>
                            <textarea name="keterangan" class="form-control" rows="3" placeholder="Keterangan berupa Kendala dan Evaluasi" required style="height: 120px"></textarea>
                        </div>

                    </div>
                </div>

                <div class="modal-footer">
                    <button type="submit" class="btn btn-success"><i class="fa fa-upload me-1"></i> Upload</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                </div>
            </form>
        </div>
    </div>
</div>